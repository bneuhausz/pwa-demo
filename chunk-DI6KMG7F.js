import{A as p,Ea as N,Ga as O,H as h,K as d,L as R,M,O as I,Q as S,R as v,S as P,_ as k,a as D,ca as C,f as E,i as y,q as f,v as u,w as m}from"./chunk-5MFH4WBZ.js";var T="Service workers are disabled or not supported by this browser",l=class{serviceWorker;worker;registration;events;constructor(n,t){if(this.serviceWorker=n,!n)this.worker=this.events=this.registration=new E(r=>r.error(new d(5601,!1)));else{let r=null,e=new y;this.worker=new E(c=>(r!==null&&c.next(r),e.subscribe(w=>c.next(w))));let o=()=>{let{controller:c}=n;c!==null&&(r=c,e.next(r))};n.addEventListener("controllerchange",o),o(),this.registration=this.worker.pipe(h(()=>n.getRegistration()));let i=new y;this.events=i.asObservable();let a=c=>{let{data:w}=c;w?.type&&i.next(w)};n.addEventListener("message",a),t?.get(O,null,{optional:!0})?.onDestroy(()=>{n.removeEventListener("controllerchange",o),n.removeEventListener("message",a)})}}postMessage(n,t){return new Promise(r=>{this.worker.pipe(p(1)).subscribe(e=>{e.postMessage(D({action:n},t)),r()})})}postMessageWithOperation(n,t,r){let e=this.waitForOperationCompleted(r),o=this.postMessage(n,t);return Promise.all([o,e]).then(([,i])=>i)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(n){let t;return typeof n=="string"?t=r=>r.type===n:t=r=>n.includes(r.type),this.events.pipe(m(t))}nextEventOfType(n){return this.eventsOfType(n).pipe(p(1))}waitForOperationCompleted(n){return new Promise((t,r)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(m(e=>e.nonce===n),p(1),f(e=>{if(e.result!==void 0)return e.result;throw new Error(e.error)})).subscribe({next:t,error:r})})}get isEnabled(){return!!this.serviceWorker}},j=(()=>{class s{sw;messages;notificationClicks;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new y;constructor(t){if(this.sw=t,!t.isEnabled){this.messages=u,this.notificationClicks=u,this.subscription=u;return}this.messages=this.sw.eventsOfType("PUSH").pipe(f(e=>e.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(f(e=>e.data)),this.pushManager=this.sw.registration.pipe(f(e=>e.pushManager));let r=this.pushManager.pipe(h(e=>e.getSubscription()));this.subscription=new E(e=>{let o=r.subscribe(e),i=this.subscriptionChanges.subscribe(e);return()=>{o.unsubscribe(),i.unsubscribe()}})}requestSubscription(t){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(T));let r={userVisibleOnly:!0},e=this.decodeBase64(t.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),o=new Uint8Array(new ArrayBuffer(e.length));for(let i=0;i<e.length;i++)o[i]=e.charCodeAt(i);return r.applicationServerKey=o,new Promise((i,a)=>{this.pushManager.pipe(h(g=>g.subscribe(r)),p(1)).subscribe({next:g=>{this.subscriptionChanges.next(g),i(g)},error:a})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(T));let t=r=>{if(r===null)throw new d(5602,!1);return r.unsubscribe().then(e=>{if(!e)throw new d(5603,!1);this.subscriptionChanges.next(null)})};return new Promise((r,e)=>{this.subscription.pipe(p(1),h(t)).subscribe({next:r,error:e})})}decodeBase64(t){return atob(t)}static \u0275fac=function(r){return new(r||s)(S(l))};static \u0275prov=M({token:s,factory:s.\u0275fac})}return s})(),U=(()=>{class s{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}constructor(t){if(this.sw=t,!t.isEnabled){this.versionUpdates=u,this.unrecoverable=u;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(T));let t=this.sw.generateNonce();return this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:t},t)}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new d(5601,!1));let t=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:t},t)}static \u0275fac=function(r){return new(r||s)(S(l))};static \u0275prov=M({token:s,factory:s.\u0275fac})}return s})();var A=new I("");function W(){let s=v(b);if(!("serviceWorker"in navigator&&s.enabled!==!1))return;let n=v(A),t=v(C),r=v(O);t.runOutsideAngular(()=>{let e=navigator.serviceWorker,o=()=>e.controller?.postMessage({action:"INITIALIZE"});e.addEventListener("controllerchange",o),r.onDestroy(()=>{e.removeEventListener("controllerchange",o)})}),t.runOutsideAngular(()=>{let e,{registrationStrategy:o}=s;if(typeof o=="function")e=new Promise(i=>o().subscribe(()=>i()));else{let[i,...a]=(o||"registerWhenStable:30000").split(":");switch(i){case"registerImmediately":e=Promise.resolve();break;case"registerWithDelay":e=_(+a[0]||0);break;case"registerWhenStable":e=Promise.race([r.whenStable(),_(+a[0])]);break;default:throw new d(5600,!1)}}e.then(()=>{r.destroyed||navigator.serviceWorker.register(n,{scope:s.scope}).catch(i=>console.error(R(5604,!1)))})})}function _(s){return new Promise(n=>setTimeout(n,s))}function L(s,n){return new l(s.enabled!==!1?navigator.serviceWorker:void 0,n)}var b=class{enabled;scope;registrationStrategy};function H(s,n={}){return P([j,U,{provide:A,useValue:s},{provide:b,useValue:n},{provide:l,useFactory:L,deps:[b,k]},N(W)])}export{j as a,U as b,H as c};
